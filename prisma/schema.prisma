// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id              String   @id @default(uuid())
  email           String   @unique
  password_hash   String
  name            String?
  is_admin        Boolean  @default(true)
  created_at      DateTime @default(now())
  updated_at      DateTime @updatedAt
  last_login      DateTime?

  @@map("users")
}

model Category {
  id                String   @id @default(uuid())
  name              String   @unique
  description       String?
  google_folder_id  String   @unique  // Google Drive folder ID
  is_active         Boolean  @default(true)  // Whether to display this folder
  folder_path       String?  // Full path in Google Drive
  cover_image       String?  // Cover image URL or base64 data
  sort_order        Int      @default(0)  // Order for display
  created_at        DateTime @default(now())
  updated_at        DateTime @updatedAt
  last_synced       DateTime?
  
  // Relationship to entries
  entries           Entry[]

  @@map("categories")
}

model Entry {
  id              String   @id @default(uuid())
  title           String?
  description     String?
  google_file_id  String   @unique  // Google Drive file ID
  filename        String   // Original filename
  media_url       String   // Google Drive shareable link
  media_type      String   // 'image' | 'video'
  file_size       Int?     // File size in bytes
  is_favorite     Boolean  @default(false)
  created_at      DateTime @default(now())
  updated_at      DateTime @updatedAt
  
  // Foreign key to category
  category_id     String
  category        Category @relation(fields: [category_id], references: [id], onDelete: Cascade)

  @@map("entries")
}

model FolderDiary {
  id         String   @id @default(uuid())
  folderId   String   @unique  // Google Drive folder ID
  content    String   @default("")  // Diary entry content
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@map("folder_diaries")
}

model FolderCover {
  id         String   @id @default(uuid())
  folderId   String   @unique  // Google Drive folder ID
  fileName   String   // Original filename
  fileSize   Int      // File size in bytes
  mimeType   String   // Image MIME type
  storageUrl String   // Supabase storage URL
  publicUrl  String   // Public accessible URL
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@map("folder_covers")
}